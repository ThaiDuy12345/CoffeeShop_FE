<div class="mx-auto container px-32 py-1 grid grid-cols-1 gap-x-10 my-10">
  <nz-breadcrumb class="w-full mb-5">
    <nz-breadcrumb-item>
      <a [routerLink]="'/main/product'">Menu</a>
    </nz-breadcrumb-item>
    <nz-breadcrumb-item (click)="navigateRelatedProduct()">
      <a>{{ product.category.name }}</a>
    </nz-breadcrumb-item>
    <nz-breadcrumb-item>{{ product.name }}</nz-breadcrumb-item>
  </nz-breadcrumb>
  <div class="w-full">
    <button
      [routerLink]="'/main/product'"
      class="text-sm text-left second-text-color mb-3"
    >
      <fa-icon [icon]="icons['faArrowLeft']"></fa-icon> Danh sách sản phẩm
    </button>
  </div>
  <nb-card>
    <nb-card-body class="grid grid-cols-5 space-x-5">
      <app-image class="col-span-2" [src]="product.picture"></app-image>
      <div class="col-span-3">
        <div class="font-bold w-full text-4xl mb-2">{{ product.name }}</div>
        <div class="w-full mb-10">
          <span class="me-5">
            {{ avarageStar ? avarageStar : '0' }}
            <fa-icon
              [icon]="icons['faStar']"
              [style]="'color: ' + renderStarColor(avarageStar)"
            ></fa-icon>
          </span>
          <span class="me-5"> {{ feedBackProducts.length > 0 ?  feedBackProducts.length + ' Phản hồi' : 'Chưa có phản hồi'}}  </span>
          <span class=""> 10 Lượt bán </span>
        </div>
        <nz-divider [nzText]="text"></nz-divider>
        <ng-template #text>
          <fa-icon [icon]="icons['faCartFlatbed']" class="text-lg"></fa-icon>
        </ng-template>
        <div class="w-full mt-10 mb-10">
          <span class="me-5"> Số lượng: </span>
          <span class="font-bold me-5">
            <nb-button-group>
              <button
                nbButton
                (click)="
                  selected.quantity > 0
                    ? (selected.quantity = selected.quantity - 1)
                    : null
                "
              >
                -
              </button>
              <input
                [(ngModel)]="selected.quantity"
                name="quantityInput"
                #quantityInput="ngModel"
                nbInput
                class="w-[50px]"
              />
              <button
                nbButton
                (click)="selected.quantity = selected.quantity + 1"
              >
                +
              </button>
            </nb-button-group>
          </span>
          <span class="me-5">
            {{
              product.quantity === -1
                ? "Luôn sẵn có"
                : product.quantity + "sản phẩm sẵn có"
            }}
          </span>
        </div>
        <div class="w-full mb-5">
          <button nbButton class="w-full" status="infor" [nbSpinner]="isLoadingAddToCartBuntton" (click)="onClickAddToCart()" nbSpinnerStatus="success">
            <fa-icon class="me-3" [icon]="icons['faBasketShopping']"></fa-icon
            >Thêm vào giỏ hàng
          </button>
        </div>
        <div class="w-full mb-5">
          <button nbButton class="w-full" status="success" [nbSpinner]="isLoadingBuyNowButton" (click)="onClickBuyNow()" nbSpinnerStatus="warning">
            <fa-icon class="me-3" [icon]="icons['faCreditCard']"></fa-icon>Mua
            và thanh toán ngay
          </button>
        </div>
      </div>
    </nb-card-body>
  </nb-card>
  <nb-card>
    <nb-card-header class="border-none"> Mô tả sản phẩm </nb-card-header>
    <nb-card-body>
      {{ product.description }}
    </nb-card-body>
  </nb-card>
  <nb-card>
    <nb-card-header class="border-none grid grid-cols-2">
      <div class="text-start">Các lượt phản hồi</div>
      <div class="text-end second-text-color">
        <span (click)="open(dialog)" class="cursor-pointer">
          Review sản phẩm <fa-icon [icon]="icons['faPencil']"></fa-icon>
        </span>
      </div>
    </nb-card-header>
    <nb-card-body class="grid grid-cols-1">
      <ng-container *ngIf="feedBackProducts.length > 0">
        <nz-comment
          [nzAuthor]="fb.account.name"
          [nzDatetime]="timeSince(fb.creationDate)"
          *ngFor="let fb of feedBackProductsPg"
        >
          <nz-avatar
            nz-comment-avatar
            [nzText]="fb.account.name[0].toUpperCase()"
            style="color: rgb(55 65 81); background-color: #30b970"
          ></nz-avatar>
          <nz-comment-content>
            <fa-icon
              [icon]="icons['faStar']"
              [style]="'color: ' + renderStarColor(fb.star)"
              *ngFor="let i of [].constructor(fb.star)"
            ></fa-icon>
            <br />
            {{ fb.comment }}
          </nz-comment-content>
        </nz-comment>
      </ng-container>
      <nz-result
        *ngIf="feedBackProducts.length === 0"
        [nzIcon]="'smile-twotone'"
        nzTitle="Ối, chưa có đánh giá nào cả!!"
      >
      </nz-result>
    </nb-card-body>
    <nb-card-footer class="border-none center-an-item">
      <nz-pagination
        (nzPageIndexChange)="onFeedBackPageChange($event)"
        [nzPageIndex]="feedBackPageIndex"
        nzPageSize="3"
        [nzTotal]="feedBackProducts.length"
      ></nz-pagination>
    </nb-card-footer>
  </nb-card>
  <nb-card>
    <nb-card-header class="border-none"> Sản phẩm liên quan </nb-card-header>
    <nb-card-body>
      <app-product-list
        [products]="relatedProducts"
        [isRelatedProductList]="true"
      ></app-product-list>
    </nb-card-body>
    <nb-card-footer class="border-none">
      <a class="w-full text-center block" (click)="navigateRelatedProduct()"
        ><fa-icon [icon]="icons['faBars']"></fa-icon> &ensp;Xem thêm</a
      >
    </nb-card-footer>
  </nb-card>
</div>

<ng-template #dialog let-data let-ref="dialogRef">
  <nb-card>
    <nb-card-header>Tạo review cho sản phẩm "{{ product.name }}"</nb-card-header>
    <nb-card-body class="grid grid-cols-1 p-10">
      <div class="w-full grid-cols-1 grid">
        <div class="font-bold text-2xl text-center mb-5">Bản cảm thấy sản phẩm này như nào?</div>
        <div class="center-an-item mb-10">
          <ng-container *ngFor="let icon of [].constructor(5); let i = index">
            <fa-icon
              [icon]="icons['faStar']"
              [style]="'color: ' + renderStarColor(i <= starRating - 1 ? starRating : 0)"
              (click)="starRating = i + 1"
              class="me-3 cursor-pointer"
            ></fa-icon>
          </ng-container>
        </div>
        <div>
          <label>Viết cảm nhận</label>
          <textarea nbInput fullWidth placeholder="Cảm nhận của bạn về sản phẩm này"></textarea>
        </div>
      </div>
    </nb-card-body>
    <nb-card-footer class="space-x-3">
      <button nbButton status="infor" (click)="ref.close()">Huỷ</button>
      <button nbButton status="success" (click)="onClickSubmit()">
        Xác nhận
      </button>
    </nb-card-footer>
  </nb-card>
</ng-template>
